-- Connecta’t com a SYSDBA al PDB XEPDB1 abans d’executar:

-- Creem l'usuari hospital_user i li otorguem tots els privilegis necessaris

BEGIN
   EXECUTE IMMEDIATE 'CREATE USER HOSPITAL_USER IDENTIFIED BY hospital';
EXCEPTION
   WHEN OTHERS THEN
      IF SQLCODE != -01920 THEN
         RAISE;
      END IF;
END;
/

BEGIN
   EXECUTE IMMEDIATE 'GRANT CREATE SESSION TO HOSPITAL_USER';
   EXECUTE IMMEDIATE 'GRANT CONNECT, RESOURCE TO HOSPITAL_USER';
EXCEPTION
   WHEN OTHERS THEN
      NULL;
END;
/

BEGIN
   EXECUTE IMMEDIATE '
      CREATE TABLE HOSPITAL_USER.PATIENT (
         ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
         NHSID VARCHAR2(50),
         FIRSTNAME VARCHAR2(100),
         LASTNAME VARCHAR2(100)
      )
   ';
EXCEPTION
   WHEN OTHERS THEN
      IF SQLCODE != -955 THEN
         RAISE;
      END IF;
END;
/

SET FEEDBACK ON
SET SERVEROUTPUT ON
SELECT table_name FROM all_tables WHERE owner = 'HOSPITAL_USER';

EXIT;
